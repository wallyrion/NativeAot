{
  "id": null,
  "uid": "dotnet-metrics-dashboard",
  "title": "ASP.NET Core Application Metrics",
  "tags": ["dotnet", "metrics", "observability"],
  "timezone": "browser",
  "schemaVersion": 30,
  "version": 1,
  "refresh": "10s",
  "panels": [
    {
      "type": "gauge",
      "title": "Kestrel Active Connections",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "kestrel_active_connections",
          "legendFormat": "{{network_type}} - {{server_address}}",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "max": 100,
          "thresholds": {
            "mode": "percentage",
            "steps": [
              {"color": "green", "value": null},
              {"color": "orange", "value": 70},
              {"color": "red", "value": 90}
            ]
          }
        }
      }
    },
    {
      "type": "gauge",
      "title": "Kestrel Queued Connections",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "kestrel_queued_connections",
          "legendFormat": "{{network_type}} - {{server_address}}",
          "refId": "B"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "max": 100,
          "thresholds": {
            "mode": "percentage",
            "steps": [
              {"color": "green", "value": null},
              {"color": "orange", "value": 70},
              {"color": "red", "value": 90}
            ]
          }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "HTTP Server Active Requests",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "http_server_active_requests",
          "legendFormat": "Method: {{http_request_method}}",
          "refId": "C"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short"
        }
      },
      "options": {
        "showPoints": "never"
      }
    },
    {
      "type": "heatmap",
      "title": "HTTP Server Request Duration (1m window)",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "histogram_quantile(0.5, sum(rate(http_server_request_duration_seconds_bucket[1m])) by (le)) * 1000",
          "legendFormat": "P50 {{http_route}} - {{http_request_method}}",
          "refId": "D"
        },
        {
          "expr": "histogram_quantile(0.9, sum(rate(http_server_request_duration_seconds_bucket[1m])) by (le)) * 1000",
          "legendFormat": "P90 {{http_route}} - {{http_request_method}}",
          "refId": "E"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "ms"
        }
      },
      "options": {
        "colorMode": "opacity",
        "showBuckets": true
      }
    },
    {
      "type": "timeseries",
      "title": "HTTP 404 Response Count",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "http_server_request_duration_seconds_count{http_response_status_code=\"404\"}",
          "legendFormat": "404s - {{http_request_method}} {{http_route}}",
          "refId": "F"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short"
        }
      },
      "options": {
        "showPoints": "auto"
      }
    },
    {
      "type": "timeseries",
      "title": "Routing Match Attempts",
      "datasource": "Prometheus",
      "targets": [
        {
          "expr": "sum(rate(aspnetcore_routing_match_attempts_total[5m])) by (aspnetcore_routing_match_status)",
          "legendFormat": "{{aspnetcore_routing_match_status}}",
          "refId": "G"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "short"
        }
      }
    }
  ],
  "overwrite": true
}
